{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Django API Forms","text":"<p>Django API Forms is a Python library that brings the Django Forms approach to processing RESTful HTTP request payloads (such as JSON or MessagePack) without the HTML front-end overhead.</p>"},{"location":"#overview","title":"Overview","text":"<p>Django API Forms provides a declarative way to:</p> <ul> <li>Define request validation schemas using a familiar Django-like syntax</li> <li>Parse and validate incoming API requests</li> <li>Handle nested data structures and complex validation rules</li> <li>Convert validated data into Python objects</li> <li>Populate Django models or other objects with validated data</li> </ul> <p>The library is designed to work seamlessly with Django REST APIs while maintaining the elegant syntax and validation capabilities of Django Forms.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Declarative Form Definition: Define your API request schemas using a familiar Django Forms-like syntax</li> <li>Request Validation: Validate incoming requests against your defined schemas</li> <li>Nested Data Structures: Handle complex nested JSON objects and arrays</li> <li>Custom Field Types: Specialized fields for common API use cases (BooleanField, EnumField, etc.)</li> <li>File Uploads: Support for BASE64-encoded file and image uploads</li> <li>Object Population: Easily populate Django models or other objects with validated data</li> <li>Customizable Validation: Define custom validation rules at the field or form level</li> <li>Multiple Content Types: Support for JSON, MessagePack, and extensible to other formats</li> </ul>"},{"location":"#motivation","title":"Motivation","text":"<p>The main idea was to create a simple and declarative way to specify the format of expected requests with the ability to validate them. Firstly, I tried to use Django Forms to validate my API requests (I use pure Django in my APIs). I encountered a problem with nesting my requests without a huge boilerplate. Also, the whole HTML thing was pretty useless in my RESTful APIs.</p> <p>I wanted to:</p> <ul> <li>Define my requests as objects (<code>Form</code>)</li> <li>Pass the request to my defined object (<code>form = Form.create_from_request(request, param=param))</code>)</li> <li>With the ability to pass any extra optional arguments</li> <li>Validate my request (<code>form.is_valid()</code>)</li> <li>Extract data (<code>form.cleaned_data</code> property)</li> </ul> <p>I wanted to keep:</p> <ul> <li>Friendly declarative Django syntax   (DeclarativeFieldsMetaclass is beautiful)</li> <li>Validators</li> <li>ValidationError</li> <li>Form fields (In the end, I had to \"replace\" some of them)</li> </ul> <p>So I created this Python package to cover all these expectations.</p>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from django.forms import fields\nfrom django_api_forms import Form, FormField, FieldList\n\n# Define a nested form\nclass ArtistForm(Form):\n    name = fields.CharField(required=True, max_length=100)\n    genres = FieldList(field=fields.CharField(max_length=30))\n    members = fields.IntegerField()\n\n# Define the main form\nclass AlbumForm(Form):\n    title = fields.CharField(max_length=100)\n    year = fields.IntegerField()\n    artist = FormField(form=ArtistForm)\n\n# In your view\ndef create_album(request):\n    form = AlbumForm.create_from_request(request)\n    if not form.is_valid():\n        # Handle validation errors\n        return JsonResponse({\"errors\": form.errors}, status=400)\n\n    # Access validated data\n    album_data = form.cleaned_data\n    # Do something with the data...\n\n    return JsonResponse({\"status\": \"success\"})\n</code></pre>"},{"location":"#running-tests","title":"Running Tests","text":"<pre><code># install all dependencies\npoetry install\n\n# run code-style check\npoetry run flake8 .\n\n# run the tests\npoetry run python runtests.py\n</code></pre>"},{"location":"#license","title":"License","text":"<p>Django API Forms is released under the MIT License.</p>"},{"location":"api_reference/","title":"API Reference","text":"<p>This page provides detailed documentation for the core classes and methods in Django API Forms.</p>"},{"location":"api_reference/#core-classes","title":"Core Classes","text":""},{"location":"api_reference/#form","title":"Form","text":"<p>The <code>Form</code> class is the main class for defining API request validation schemas.</p> <pre><code>from django_api_forms import Form\n\nclass MyForm(Form):\n    # Field definitions go here\n    pass\n</code></pre>"},{"location":"api_reference/#class-methods","title":"Class Methods","text":""},{"location":"api_reference/#create_from_request","title":"<code>create_from_request</code>","text":"<pre><code>@classmethod\ndef create_from_request(cls, request, **kwargs)\n</code></pre> <p>Creates a form instance from a Django request, parsing the request body according to the Content-Type header.</p> <p>Parameters: - <code>request</code>: A Django HttpRequest object - <code>**kwargs</code>: Additional keyword arguments that will be available in <code>form.extras</code></p> <p>Returns: - A form instance</p> <p>Example: <pre><code>form = MyForm.create_from_request(request, user=request.user)\n</code></pre></p>"},{"location":"api_reference/#instance-methods","title":"Instance Methods","text":""},{"location":"api_reference/#is_valid","title":"<code>is_valid</code>","text":"<pre><code>def is_valid() -&gt; bool\n</code></pre> <p>Validates the form data and returns True if the data is valid, False otherwise.</p> <p>Returns: - <code>bool</code>: True if the form data is valid, False otherwise</p> <p>Example: <pre><code>if form.is_valid():\n    # Process valid data\n    pass\n</code></pre></p>"},{"location":"api_reference/#add_error","title":"<code>add_error</code>","text":"<pre><code>def add_error(field: Tuple, errors: ValidationError)\n</code></pre> <p>Adds a validation error to the form.</p> <p>Parameters: - <code>field</code>: A tuple representing the path to the field - <code>errors</code>: A ValidationError instance</p> <p>Example: <pre><code>from django.core.exceptions import ValidationError\nform.add_error(('name',), ValidationError(\"Invalid name\"))\n</code></pre></p>"},{"location":"api_reference/#clean","title":"<code>clean</code>","text":"<pre><code>def clean()\n</code></pre> <p>Hook for performing form-wide validation. Override this method to add custom validation logic.</p> <p>Returns: - The cleaned data</p> <p>Example: <pre><code>def clean(self):\n    if self.cleaned_data['password'] != self.cleaned_data['confirm_password']:\n        raise ValidationError(\"Passwords do not match\")\n    return self.cleaned_data\n</code></pre></p>"},{"location":"api_reference/#populate","title":"<code>populate</code>","text":"<pre><code>def populate(obj, exclude: List[str] = None)\n</code></pre> <p>Populates an object with the form's cleaned data.</p> <p>Parameters: - <code>obj</code>: The object to populate - <code>exclude</code>: A list of field names to exclude from population</p> <p>Returns: - The populated object</p> <p>Example: <pre><code>user = User()\nform.populate(user)\nuser.save()\n</code></pre></p>"},{"location":"api_reference/#properties","title":"Properties","text":""},{"location":"api_reference/#cleaned_data","title":"<code>cleaned_data</code>","text":"<p>A dictionary containing the validated form data.</p>"},{"location":"api_reference/#errors","title":"<code>errors</code>","text":"<p>A list of validation errors.</p>"},{"location":"api_reference/#dirty","title":"<code>dirty</code>","text":"<p>A list of field names that were present in the request data.</p>"},{"location":"api_reference/#extras","title":"<code>extras</code>","text":"<p>A dictionary containing the additional keyword arguments passed to <code>create_from_request</code>.</p>"},{"location":"api_reference/#modelform","title":"ModelForm","text":"<p>The <code>ModelForm</code> class is an experimental class for creating forms from Django models.</p> <pre><code>from django_api_forms import ModelForm\nfrom myapp.models import MyModel\n\nclass MyModelForm(ModelForm):\n    class Meta:\n        model = MyModel\n        exclude = ('created_at',)\n</code></pre>"},{"location":"api_reference/#field-classes","title":"Field Classes","text":"<p>Django API Forms provides several custom field classes in addition to the standard Django form fields.</p>"},{"location":"api_reference/#booleanfield","title":"BooleanField","text":"<p>A field that normalizes to a Python boolean value.</p> <pre><code>from django_api_forms import BooleanField\n\nclass MyForm(Form):\n    is_active = BooleanField()\n</code></pre>"},{"location":"api_reference/#fieldlist","title":"FieldList","text":"<p>A field for lists of primitive values.</p> <pre><code>from django_api_forms import FieldList\nfrom django.forms import fields\n\nclass MyForm(Form):\n    tags = FieldList(field=fields.CharField(max_length=50))\n</code></pre>"},{"location":"api_reference/#formfield","title":"FormField","text":"<p>A field for nested objects.</p> <pre><code>from django_api_forms import FormField\n\nclass AddressForm(Form):\n    street = fields.CharField(max_length=100)\n    city = fields.CharField(max_length=50)\n\nclass UserForm(Form):\n    name = fields.CharField(max_length=100)\n    address = FormField(form=AddressForm)\n</code></pre>"},{"location":"api_reference/#formfieldlist","title":"FormFieldList","text":"<p>A field for lists of nested objects.</p> <pre><code>from django_api_forms import FormFieldList\n\nclass PhoneForm(Form):\n    number = fields.CharField(max_length=20)\n    type = fields.CharField(max_length=10)\n\nclass UserForm(Form):\n    name = fields.CharField(max_length=100)\n    phones = FormFieldList(form=PhoneForm)\n</code></pre>"},{"location":"api_reference/#enumfield","title":"EnumField","text":"<p>A field for enumeration values.</p> <pre><code>from django_api_forms import EnumField\nfrom enum import Enum\n\nclass UserType(Enum):\n    ADMIN = 'admin'\n    USER = 'user'\n\nclass UserForm(Form):\n    name = fields.CharField(max_length=100)\n    type = EnumField(enum=UserType)\n</code></pre>"},{"location":"api_reference/#dictionaryfield","title":"DictionaryField","text":"<p>A field for key-value pairs.</p> <pre><code>from django_api_forms import DictionaryField\n\nclass MetadataForm(Form):\n    metadata = DictionaryField(value_field=fields.CharField())\n</code></pre>"},{"location":"api_reference/#filefield","title":"FileField","text":"<p>A field for BASE64-encoded files.</p> <pre><code>from django_api_forms import FileField\n\nclass DocumentForm(Form):\n    document = FileField(max_length=10485760, mime=('application/pdf',))\n</code></pre>"},{"location":"api_reference/#imagefield","title":"ImageField","text":"<p>A field for BASE64-encoded images.</p> <pre><code>from django_api_forms import ImageField\n\nclass ProfileForm(Form):\n    avatar = ImageField(max_length=10485760, mime=('image/jpeg', 'image/png'))\n</code></pre>"},{"location":"api_reference/#rrulefield","title":"RRuleField","text":"<p>A field for recurring date rules.</p> <pre><code>from django_api_forms import RRuleField\n\nclass EventForm(Form):\n    recurrence = RRuleField()\n</code></pre>"},{"location":"api_reference/#geojsonfield","title":"GeoJSONField","text":"<p>A field for geographic data in GeoJSON format.</p> <pre><code>from django_api_forms import GeoJSONField\n\nclass LocationForm(Form):\n    geometry = GeoJSONField(srid=4326)\n</code></pre>"},{"location":"api_reference/#population-strategies","title":"Population Strategies","text":"<p>Django API Forms provides several population strategies for populating objects with form data.</p>"},{"location":"api_reference/#basestrategy","title":"BaseStrategy","text":"<p>The default strategy that sets object attributes using <code>setattr</code>.</p>"},{"location":"api_reference/#ignorestrategy","title":"IgnoreStrategy","text":"<p>A strategy that ignores the field during population.</p>"},{"location":"api_reference/#modelchoicefieldstrategy","title":"ModelChoiceFieldStrategy","text":"<p>A strategy for populating model choice fields.</p>"},{"location":"api_reference/#aliasstrategy","title":"AliasStrategy","text":"<p>A strategy for populating fields with different names.</p> <pre><code>from django_api_forms import Form\nfrom django_api_forms.population_strategies import AliasStrategy\n\nclass MyForm(Form):\n    class Meta:\n        field_strategy = {\n            'username': AliasStrategy(property_name='name')\n        }\n\n    username = fields.CharField(max_length=100)\n</code></pre>"},{"location":"api_reference/#settings","title":"Settings","text":"<p>Django API Forms can be configured through Django settings.</p>"},{"location":"api_reference/#django_api_forms_parsers","title":"<code>DJANGO_API_FORMS_PARSERS</code>","text":"<p>A dictionary mapping content types to parser functions.</p> <pre><code>DJANGO_API_FORMS_PARSERS = {\n    'application/json': 'json.loads',\n    'application/x-msgpack': 'msgpack.loads'\n}\n</code></pre>"},{"location":"api_reference/#django_api_forms_population_strategies","title":"<code>DJANGO_API_FORMS_POPULATION_STRATEGIES</code>","text":"<p>A dictionary mapping field types to population strategies.</p> <pre><code>DJANGO_API_FORMS_POPULATION_STRATEGIES = {\n    'django_api_forms.fields.FormFieldList': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.FileField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.ImageField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.FormField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django.forms.models.ModelMultipleChoiceField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django.forms.models.ModelChoiceField': 'django_api_forms.population_strategies.ModelChoiceFieldStrategy'\n}\n</code></pre>"},{"location":"api_reference/#django_api_forms_default_population_strategy","title":"<code>DJANGO_API_FORMS_DEFAULT_POPULATION_STRATEGY</code>","text":"<p>The default population strategy to use when no specific strategy is defined.</p> <pre><code>DJANGO_API_FORMS_DEFAULT_POPULATION_STRATEGY = 'django_api_forms.population_strategies.BaseStrategy'\n</code></pre>"},{"location":"contributing/","title":"Contributing to Django API Forms","text":"<p>Thank you for your interest in contributing to Django API Forms! This document provides guidelines and instructions for contributing to the project.</p>"},{"location":"contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>By participating in this project, you are expected to uphold our Code of Conduct, which is to be respectful and considerate of others.</p>"},{"location":"contributing/#getting-started","title":"Getting Started","text":""},{"location":"contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.9+</li> <li>Django 2.0+</li> <li>Poetry (for dependency management)</li> </ul>"},{"location":"contributing/#setting-up-the-development-environment","title":"Setting Up the Development Environment","text":"<ol> <li>Fork the repository on GitHub</li> <li>Clone your fork locally:    <pre><code>git clone https://github.com/YOUR-USERNAME/django_api_forms.git\ncd django_api_forms\n</code></pre></li> <li>Install dependencies using Poetry:    <pre><code>poetry install\n</code></pre></li> </ol>"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/#running-tests","title":"Running Tests","text":"<p>We use Django's test framework for testing. To run the tests:</p> <pre><code>poetry run python runtests.py\n</code></pre> <p>To run tests with coverage:</p> <pre><code>poetry run coverage run runtests.py\npoetry run coverage report\n</code></pre>"},{"location":"contributing/#code-style","title":"Code Style","text":"<p>We follow PEP 8 style guidelines. We use flake8 for code style checking:</p> <pre><code>poetry run flake8 .\n</code></pre>"},{"location":"contributing/#documentation","title":"Documentation","text":"<p>We use mkdocs-material for documentation. To build and serve the documentation locally:</p> <pre><code>poetry run mkdocs serve\n</code></pre> <p>Then open http://127.0.0.1:8000/ in your browser.</p>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li> <p>Create a new branch for your feature or bugfix:    <pre><code>git checkout -b feature/your-feature-name\n</code></pre>    or    <pre><code>git checkout -b fix/your-bugfix-name\n</code></pre></p> </li> <li> <p>Make your changes and commit them with a descriptive commit message:    <pre><code>git commit -m \"Add feature: your feature description\"\n</code></pre></p> </li> <li> <p>Push your branch to your fork:    <pre><code>git push origin feature/your-feature-name\n</code></pre></p> </li> <li> <p>Open a pull request against the <code>master</code> branch of the original repository.</p> </li> <li> <p>Ensure that all tests pass and the documentation is updated if necessary.</p> </li> <li> <p>Wait for a maintainer to review your pull request. They may request changes or improvements.</p> </li> <li> <p>Once your pull request is approved, it will be merged into the main codebase.</p> </li> </ol>"},{"location":"contributing/#reporting-issues","title":"Reporting Issues","text":"<p>If you find a bug or have a feature request, please open an issue on the GitHub issue tracker.</p> <p>When reporting a bug, please include:</p> <ul> <li>A clear and descriptive title</li> <li>Steps to reproduce the issue</li> <li>Expected behavior</li> <li>Actual behavior</li> <li>Django and Python versions</li> <li>Any relevant code snippets or error messages</li> </ul>"},{"location":"contributing/#feature-requests","title":"Feature Requests","text":"<p>Feature requests are welcome. Please provide a clear description of the feature and why it would be beneficial to the project.</p>"},{"location":"contributing/#versioning","title":"Versioning","text":"<p>We use Semantic Versioning for versioning. For the versions available, see the tags on this repository.</p>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing to Django API Forms, you agree that your contributions will be licensed under the project's MIT License.</p>"},{"location":"contributing/#questions","title":"Questions?","text":"<p>If you have any questions about contributing, feel free to open an issue or contact the maintainers.</p> <p>Thank you for contributing to Django API Forms!</p>"},{"location":"example/","title":"Examples","text":"<p>This page provides examples of how to use Django API Forms in different scenarios.</p>"},{"location":"example/#configuration-settings","title":"Configuration Settings","text":"<p>Django API Forms can be configured through Django settings. Here are the default settings:</p> <pre><code># Settings for population strategies\nDJANGO_API_FORMS_POPULATION_STRATEGIES = {\n    'django_api_forms.fields.FormFieldList': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.FileField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.ImageField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.FormField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django.forms.models.ModelMultipleChoiceField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django.forms.models.ModelChoiceField': 'django_api_forms.population_strategies.ModelChoiceFieldStrategy'\n}\n\n# Default population strategy\nDJANGO_API_FORMS_DEFAULT_POPULATION_STRATEGY = 'django_api_forms.population_strategies.BaseStrategy'\n\n# Content type parsers\nDJANGO_API_FORMS_PARSERS = {\n    'application/json': 'json.loads',\n    'application/x-msgpack': 'msgpack.loads'\n}\n</code></pre>"},{"location":"example/#basic-example-music-album-api","title":"Basic Example: Music Album API","text":"<p>This example demonstrates a music album API with nested data structures, field mapping, and custom validation.</p>"},{"location":"example/#json-request","title":"JSON Request","text":"<pre><code>{\n  \"title\": \"Unknown Pleasures\",\n  \"type\": \"vinyl\",\n  \"artist\": {\n    \"_name\": \"Joy Division\",\n    \"genres\": [\n      \"rock\",\n      \"punk\"\n    ],\n    \"members\": 4\n  },\n  \"year\": 1979,\n  \"songs\": [\n    {\n      \"title\": \"Disorder\",\n      \"duration\": \"3:29\"\n    },\n    {\n      \"title\": \"Day of the Lords\",\n      \"duration\": \"4:48\",\n      \"metadata\": {\n        \"_section\": {\n          \"type\": \"ID3v2\",\n          \"offset\": 0,\n          \"byteLength\": 2048\n        },\n        \"header\": {\n          \"majorVersion\": 3,\n          \"minorRevision\": 0,\n          \"flagsOctet\": 0,\n          \"unsynchronisationFlag\": false,\n          \"extendedHeaderFlag\": false,\n          \"experimentalIndicatorFlag\": false,\n          \"size\": 2038\n        }\n      }\n    }\n  ],\n  \"metadata\": {\n    \"created_at\": \"2019-10-21T18:57:03+0100\",\n    \"updated_at\": \"2019-10-21T18:57:03+0100\"\n  }\n}\n</code></pre>"},{"location":"example/#python-implementation","title":"Python Implementation","text":"<pre><code>from enum import Enum\n\nfrom django.core.exceptions import ValidationError\nfrom django.forms import fields\nfrom django.http import JsonResponse\n\nfrom django_api_forms import FieldList, FormField, FormFieldList, DictionaryField, EnumField, AnyField, Form\n\n\nclass AlbumType(Enum):\n    CD = 'cd'\n    VINYL = 'vinyl'\n\n\nclass ArtistForm(Form):\n    class Meta:\n        mapping = {\n            '_name': 'name'  # Map '_name' in JSON to 'name' in form\n        }\n\n    name = fields.CharField(required=True, max_length=100)\n    genres = FieldList(field=fields.CharField(max_length=30))\n    members = fields.IntegerField()\n\n\nclass SongForm(Form):\n    title = fields.CharField(required=True, max_length=100)\n    duration = fields.DurationField(required=False)\n    metadata = AnyField(required=False)\n\n\nclass AlbumForm(Form):\n    title = fields.CharField(max_length=100)\n    year = fields.IntegerField()\n    artist = FormField(form=ArtistForm)  # Nested form\n    songs = FormFieldList(form=SongForm)  # List of nested forms\n    type = EnumField(enum=AlbumType, required=True)\n    metadata = DictionaryField(value_field=fields.DateTimeField())\n\n    def clean_year(self):\n        # Field-level validation\n        if 'param' not in self.extras:\n            raise ValidationError(\"You can use request GET params in form validation!\")\n\n        if self.cleaned_data['year'] == 1992:\n            raise ValidationError(\"Year 1992 is forbidden!\", 'forbidden-value')\n        return self.cleaned_data['year']\n\n    def clean(self):\n        # Form-level validation\n        if (self.cleaned_data['year'] == 1998) and (self.cleaned_data['artist']['name'] == \"Nirvana\"):\n            raise ValidationError(\"Sounds like a bullshit\", code='time-traveling')\n        if 'param' not in self.extras:\n            self.add_error(\n                ('param', ),\n                ValidationError(\"You can use extra optional arguments in form validation!\", code='param-where')\n            )\n        return self.cleaned_data\n\n\n# Django view example\ndef create_album(request):\n    # Create form from request and pass extra parameters\n    form = AlbumForm.create_from_request(request, param=request.GET.get('param'))\n\n    if not form.is_valid():\n        # Return validation errors\n        return JsonResponse({\"errors\": form.errors}, status=400)\n\n    # Access validated data\n    album_data = form.cleaned_data\n\n    # Do something with the data (e.g., save to database)\n    # ...\n\n    return JsonResponse({\"status\": \"success\", \"id\": 123})\n</code></pre>"},{"location":"example/#example-user-registration-with-file-upload","title":"Example: User Registration with File Upload","text":"<p>This example demonstrates a user registration API with profile image upload.</p>"},{"location":"example/#json-request_1","title":"JSON Request","text":"<pre><code>{\n  \"username\": \"johndoe\",\n  \"email\": \"john@example.com\",\n  \"password\": \"securepassword123\",\n  \"confirm_password\": \"securepassword123\",\n  \"profile\": {\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"bio\": \"Software developer and music enthusiast\",\n    \"avatar\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+P+/HgAFdwI2Q4g02QAAAABJRU5ErkJggg==\"\n  }\n}\n</code></pre>"},{"location":"example/#python-implementation_1","title":"Python Implementation","text":"<pre><code>from django.core.exceptions import ValidationError\nfrom django.forms import fields\nfrom django.http import JsonResponse\nfrom django.contrib.auth.models import User\nfrom django.contrib.auth.password_validation import validate_password\n\nfrom django_api_forms import Form, FormField, ImageField\n\n\nclass ProfileForm(Form):\n    first_name = fields.CharField(max_length=30)\n    last_name = fields.CharField(max_length=30)\n    bio = fields.CharField(max_length=500, required=False)\n    avatar = ImageField(required=False, mime=('image/jpeg', 'image/png'))\n\n\nclass UserRegistrationForm(Form):\n    username = fields.CharField(max_length=150)\n    email = fields.EmailField()\n    password = fields.CharField(min_length=8)\n    confirm_password = fields.CharField()\n    profile = FormField(form=ProfileForm)\n\n    def clean_username(self):\n        username = self.cleaned_data['username']\n        if User.objects.filter(username=username).exists():\n            raise ValidationError(\"Username already exists\")\n        return username\n\n    def clean_email(self):\n        email = self.cleaned_data['email']\n        if User.objects.filter(email=email).exists():\n            raise ValidationError(\"Email already exists\")\n        return email\n\n    def clean_password(self):\n        password = self.cleaned_data['password']\n        # Use Django's password validation\n        validate_password(password)\n        return password\n\n    def clean(self):\n        cleaned_data = self.cleaned_data\n        if cleaned_data.get('password') != cleaned_data.get('confirm_password'):\n            raise ValidationError(\"Passwords do not match\")\n        return cleaned_data\n\n    def populate_avatar(self, user, value):\n        # Custom population for avatar field\n        if value and hasattr(user, 'profile'):\n            filename = f\"{user.username}_avatar.png\"\n            user.profile.avatar.save(filename, value, save=False)\n        return value\n\n\ndef register_user(request):\n    form = UserRegistrationForm.create_from_request(request)\n\n    if not form.is_valid():\n        return JsonResponse({\"errors\": form.errors}, status=400)\n\n    # Create user\n    user = User(\n        username=form.cleaned_data['username'],\n        email=form.cleaned_data['email']\n    )\n    user.set_password(form.cleaned_data['password'])\n    user.save()\n\n    # Create profile\n    profile_data = form.cleaned_data['profile']\n    profile = user.profile  # Assuming a profile is created via signal\n    profile.first_name = profile_data['first_name']\n    profile.last_name = profile_data['last_name']\n    profile.bio = profile_data.get('bio', '')\n\n    # Handle avatar upload\n    if 'avatar' in profile_data:\n        form.populate_avatar(user, profile_data['avatar'])\n\n    profile.save()\n\n    return JsonResponse({\"status\": \"success\", \"id\": user.id})\n</code></pre>"},{"location":"example/#example-api-with-django-models","title":"Example: API with Django Models","text":"<p>This example demonstrates how to use Django API Forms with Django models.</p>"},{"location":"example/#models","title":"Models","text":"<pre><code>from django.db import models\n\nclass Category(models.Model):\n    name = models.CharField(max_length=100)\n\n    def __str__(self):\n        return self.name\n\nclass Tag(models.Model):\n    name = models.CharField(max_length=50)\n\n    def __str__(self):\n        return self.name\n\nclass Article(models.Model):\n    title = models.CharField(max_length=200)\n    content = models.TextField()\n    category = models.ForeignKey(Category, on_delete=models.CASCADE)\n    tags = models.ManyToManyField(Tag)\n    published = models.BooleanField(default=False)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n\n    def __str__(self):\n        return self.title\n</code></pre>"},{"location":"example/#json-request_2","title":"JSON Request","text":"<pre><code>{\n  \"title\": \"Introduction to Django API Forms\",\n  \"content\": \"Django API Forms is a powerful library for validating API requests...\",\n  \"category_id\": 1,\n  \"tags\": [1, 2, 3],\n  \"published\": true\n}\n</code></pre>"},{"location":"example/#python-implementation_2","title":"Python Implementation","text":"<pre><code>from django.forms import fields, ModelChoiceField, ModelMultipleChoiceField\nfrom django.http import JsonResponse\n\nfrom django_api_forms import Form, BooleanField\nfrom myapp.models import Article, Category, Tag\n\n\nclass ArticleForm(Form):\n    title = fields.CharField(max_length=200)\n    content = fields.CharField()\n    category_id = ModelChoiceField(queryset=Category.objects.all())\n    tags = ModelMultipleChoiceField(queryset=Tag.objects.all())\n    published = BooleanField(required=False, default=False)\n\n    def clean_title(self):\n        title = self.cleaned_data['title']\n        if Article.objects.filter(title=title).exists():\n            raise ValidationError(\"An article with this title already exists\")\n        return title\n\n\ndef create_article(request):\n    form = ArticleForm.create_from_request(request)\n\n    if not form.is_valid():\n        return JsonResponse({\"errors\": form.errors}, status=400)\n\n    # Create article\n    article = Article()\n    form.populate(article)\n    article.save()\n\n    # Many-to-many relationships need to be set after save\n    article.tags.set(form.cleaned_data['tags'])\n\n    return JsonResponse({\n        \"status\": \"success\",\n        \"id\": article.id,\n        \"title\": article.title\n    })\n</code></pre> <p>These examples demonstrate different ways to use Django API Forms in real-world scenarios. You can adapt them to your specific needs and requirements.</p>"},{"location":"fields/","title":"Fields","text":"<p>Even if we tried to keep most of the native Django fields, we had to override some of them to be more fit for RESTful applications. Also, we introduced new ones, to cover extra functionality like nested requests. In this section, we will explain our intentions and describe their usage.</p> <p>To sum up:</p> <ul> <li>You can use Django Form Fields:</li> <li>CharField</li> <li>ChoiceField</li> <li>TypedChoiceField</li> <li>DateField</li> <li>DateTimeField</li> <li>DecimalField</li> <li>DurationField</li> <li>EmailField</li> <li>FilePathField</li> <li>FloatField</li> <li>IntegerField</li> <li>GenericIPAddressField</li> <li>MultipleChoiceField</li> <li>TypedMultipleChoiceField</li> <li>RegexField</li> <li>SlugField</li> <li>TimeField</li> <li>URLField</li> <li>UUIDField</li> <li>ModelChoiceField</li> <li>ModelMultipleChoiceField</li> <li>You can use Django Validators.</li> </ul> <p>Fields that are not in the list above were not been tested or been replaced with our customized implementation (or it just doesn't make sense to use them in RESTful APIs).</p>"},{"location":"fields/#booleanfield","title":"BooleanField","text":"<ul> <li>Normalizes to: A Python True or False value (or None if it's not required)</li> </ul> <p>Django BooleanField checks only for False (<code>false</code>, <code>0</code>) values and everything else is suppose to be True.</p> <p>In my point of view this kind of behaviour it's little bit weird, so we decided to check explicitly for True and False values. If field is required ValidationError is raised or value is normalized as None.</p> <p>Checked values:</p> <ul> <li>True: <code>True</code> <code>'True'</code> <code>'true'</code> <code>1</code> <code>'1'</code></li> <li>False: <code>False</code> <code>'False'</code> <code>'false'</code> <code>0</code> <code>'0'</code></li> </ul> <p>Note: We would like to change this behaviour to support only boolean values and rely on deserializers.</p>"},{"location":"fields/#fieldlist","title":"FieldList","text":"<p>This field is used to parse list of primitive values (like strings or numbers). If you want to parse list of object, check <code>FormFieldList</code>.</p> <ul> <li>Normalizes to: A Python list</li> <li>Error message keys: <code>not_field</code>, <code>not_list</code>, <code>min_length</code>, <code>max_length</code></li> <li>Required arguments:</li> <li><code>field</code>: Instance of a form field representing children</li> <li>Optional arguments:</li> <li><code>min_length</code>: Minimum length of field size as integer</li> <li><code>max_length</code>: Maximum length of field size as integer</li> </ul> <p>JSON example</p> <pre><code>{\n    \"numbers\": [\n        0,\n        1,\n        1,\n        2,\n        3,\n        5,\n        8,\n        13\n    ]\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, FieldList\nfrom django.forms import fields\n\n\nclass FibonacciForm(Form):\n    numbers = FieldList(field=fields.IntegerField())\n</code></pre>"},{"location":"fields/#formfield","title":"FormField","text":"<p>Field used for embedded objects represented as another API form.</p> <ul> <li>Normalizes to: A Python dictionary</li> <li>Required arguments:</li> <li><code>form</code>: Type of a nested form</li> </ul> <p>JSON example</p> <pre><code>{\n    \"title\": \"Unknown Pleasures\",\n    \"year\": 1979,\n    \"artist\": {\n        \"name\": \"Joy Division\",\n        \"genres\": [\n            \"rock\",\n            \"punk\"\n        ],\n        \"members\": 4\n    }\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, FormField, FieldList\nfrom django.forms import fields\n\n\nclass ArtistForm(Form):\n    name = fields.CharField(required=True, max_length=100)\n    genres = FieldList(field=fields.CharField(max_length=30))\n    members = fields.IntegerField()\n\n\nclass AlbumForm(Form):\n    title = fields.CharField(max_length=100)\n    year = fields.IntegerField()\n    artist = FormField(form=ArtistForm)\n</code></pre>"},{"location":"fields/#formfieldlist","title":"FormFieldList","text":"<p>Field used for embedded objects represented as another API form.</p> <ul> <li>Normalizes to: A Python list of dictionaries</li> <li>Error message keys: <code>not_list</code>, <code>min_length</code>, <code>max_length</code></li> <li>Required arguments:</li> <li><code>form</code>: Type of a nested form</li> <li>Optional arguments:</li> <li><code>min_length</code>: Minimum length of field size as integer</li> <li><code>max_length</code>: Maximum length of field size as integer</li> </ul> <p>JSON example</p> <pre><code>{\n    \"title\": \"Rock For People\",\n    \"artists\": [\n        {\n            \"name\": \"Joy Division\",\n            \"genres\": [\n                \"rock\",\n                \"punk\"\n            ],\n            \"members\": 4\n        }\n    ]\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, FormFieldList, FieldList\nfrom django.forms import fields\n\n\nclass ArtistForm(Form):\n    name = fields.CharField(required=True, max_length=100)\n    genres = FieldList(field=fields.CharField(max_length=30))\n    members = fields.IntegerField()\n\n\nclass FestivalForm(Form):\n    title = fields.CharField(max_length=100)\n    year = fields.IntegerField()\n    artists = FormFieldList(form=ArtistForm)\n</code></pre>"},{"location":"fields/#enumfield","title":"EnumField","text":"<p>Tip: Django has pretty cool implementation of the enumeration types.</p> <ul> <li>Normalizes to: A Python <code>Enum</code> object</li> <li>Error message keys: <code>not_enum</code>, <code>invalid</code></li> <li>Required arguments:</li> <li><code>enum</code>: Enum class</li> </ul> <p>JSON example</p> <pre><code>{\n    \"title\": \"Rock For People\",\n    \"type\": \"vinyl\"\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, EnumField\nfrom django.forms import fields\nfrom django.db.models import TextChoices\n\n\nclass AlbumType(TextChoices):\n    CD = 'cd', 'CD'\n    VINYL = 'vinyl', 'Vinyl'\n\n\nclass AlbumForm(Form):\n    title = fields.CharField(required=True, max_length=100)\n    type = EnumField(enum=AlbumType)\n</code></pre>"},{"location":"fields/#dictionaryfield","title":"DictionaryField","text":"<p>Field created for containing typed value pairs. Due to inverted key, value parameters in <code>__init__</code> method, <code>value_field</code> is forced keyword arguments.</p> <ul> <li>Normalizes to: A Python dictionary</li> <li>Error message keys: <code>not_dict</code>, <code>not_field</code></li> <li>Required arguments:</li> <li><code>value_field</code>: Type of a nested form</li> <li>Optional arguments:</li> <li><code>key_field</code>: Type of a nested form</li> </ul> <p>JSON example</p> <pre><code>{\n    \"my_dict\": {\n        \"b061bb03-1eaa-47d0-948f-3ce1f15bf3bb\": 2.718,\n        \"0a8912f0-6c10-4505-bc27-bbb099d2e395\": 42\n    }\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, DictionaryField\nfrom django.forms import fields\n\n\nclass DictionaryForm(Form):\n    my_typed_dict = DictionaryField(value_field=fields.DecimalField(), key_field=fields.UUIDField())\n</code></pre>"},{"location":"fields/#anyfield","title":"AnyField","text":"<p>Field without default validators.</p> <ul> <li>Normalizes to: Type according to the   chosen request payload parser</li> </ul> <p>JSON example</p> <pre><code>{\n    \"singer\": {\n        \"name\": \"Johnny\",\n        \"surname\": \"Rotten\",\n        \"age\": 64,\n        \"born_at\": \"1956-01-31\"\n    }\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, DictionaryField, AnyField\n\n\nclass BandForm(Form):\n    singer = DictionaryField(value_field=AnyField())\n</code></pre>"},{"location":"fields/#filefield","title":"FileField","text":"<p>This field contains BASE64 encoded file.</p> <ul> <li>Normalizes to: A Django File object</li> <li>Error message keys: <code>max_length</code>, <code>invalid_uri</code>, <code>invalid_mime</code></li> <li>Arguments:</li> <li><code>max_length</code>: Maximum files size in bytes (optional)</li> <li><code>mime</code>: Tuple of allowed mime types (optional - if present, value must be in form of     Data URI)</li> <li>Extra normalised attributes:</li> <li><code>file_field.clean(payload).content_type</code>: Mime type (<code>str</code> - e.g. <code>audio/mpeg</code>) of containing file (<code>None</code> if     unable to detect - if payload is not in DATA URI format)</li> </ul> <p>JSON example</p> <pre><code>{\n    \"title\": \"Disorder\",\n    \"type\": \"data:audio/mpeg;base64,SGVsbG8sIFdvcmxkIQ==\"\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, FileField\nfrom django.conf import settings\nfrom django.forms import fields\n\n\nclass SongForm(Form):\n    title = fields.CharField(required=True, max_length=100)\n    audio = FileField(max_length=settings.DATA_UPLOAD_MAX_MEMORY_SIZE, mime=('audio/mpeg',))\n</code></pre>"},{"location":"fields/#imagefield","title":"ImageField","text":"<p>This field contains BASE64 encoded image. Depends on Pillow because normalized value contains <code>Image</code> object. Pillow is also used for image validation Image.verify() is called.</p> <ul> <li>Normalizes to: A Django File object</li> <li>Error message keys: <code>max_length</code>, <code>invalid_uri</code>, <code>invalid_mime</code>, <code>invalid_image</code> (if Image.verify() failed)</li> <li>Arguments:</li> <li><code>max_length</code>: Maximum files size in bytes (optional)</li> <li><code>mime</code>: Tuple of allowed mime types (optional, value must be in     Data URI)</li> <li>Extra normalised attributes:</li> <li><code>image_field.clean(payload).content_type</code>: Mime type (<code>str</code> - e.g. <code>audio/mpeg</code>) of containing file (<code>None</code> if     unable to detect - if payload is not in DATA URI format). Value is filled using Pillow     <code>Image.MIME.get(image.format)</code>)</li> <li><code>image_field.clean(payload).image</code>: A Pillow     Image object instance</li> </ul> <p>JSON example</p> <pre><code>{\n    \"title\": \"Unknown pleasures\",\n    \"cover\": \"data:image/png;base64,SGVsbG8sIFdvcmxkIQ==\"\n}\n</code></pre> <p>Python representation</p> <pre><code>from django_api_forms import Form, ImageField\nfrom django.conf import settings\nfrom django.forms import fields\n\n\nclass AlbumForm(Form):\n    title = fields.CharField(required=True, max_length=100)\n    cover = ImageField(max_length=settings.DATA_UPLOAD_MAX_MEMORY_SIZE, mime=('image/png',))\n</code></pre>"},{"location":"fields/#rrule-field","title":"RRule Field","text":"<p>This field contains RRule object.</p> <ul> <li>Normalizes to a Dateutil RRule object.</li> <li>Error message keys: <code>not_rrule</code></li> </ul> <p>Python representation <pre><code>from django_api_forms import Form, RRuleField\n\n\nclass VacationForm(Form):\n    rrule = RRuleField(required=True)\n</code></pre></p>"},{"location":"fields/#geojson-field","title":"GeoJSON Field","text":"<p>This field contains GEOSGeometry django GEOS object. Translates GeoJSON format into geodjango fields. Depends on gdal because of spatial reference system (SRS) which is specified in this library.</p> <ul> <li>Error message keys: <code>not_dict</code>, <code>not_geojson</code>, <code>not_int</code>, <code>transform_error</code></li> <li>Arguments:</li> <li><code>srid</code>: spatial reference identifier (optional - default 4326)</li> <li><code>transform</code>: transform to different spatial reference identifier (optional)</li> </ul> <p>GeoJSON example <pre><code>{\n    \"geometry\": {\n         \"type\": \"Point\",\n         \"coordinates\": [90.0, 40.0]\n     }\n}\n</code></pre></p> <p>Python representation <pre><code>from django_api_forms import Form, GeoJSONField\n\n\nclass VacationForm(Form):\n    geometry = GeoJSONField(required=True, srid=4326, transform=5514)\n</code></pre></p>"},{"location":"install/","title":"Installation","text":"<p>Django API Forms is published on the PyPI index as django-api-forms. You can add it to your project using your favorite package manager.</p>"},{"location":"install/#basic-installation","title":"Basic Installation","text":"<p>Choose one of the following methods to install the basic package:</p> <pre><code># Using pip\npip install django-api-forms\n\n# Using poetry\npoetry add django-api-forms\n\n# Using pipenv\npipenv install django-api-forms\n\n# Local installation from source\npython -m pip install .\n</code></pre>"},{"location":"install/#requirements","title":"Requirements","text":"<ul> <li>Python 3.9+</li> <li>Django 2.0+</li> </ul>"},{"location":"install/#optional-dependencies","title":"Optional Dependencies","text":"<p>Django API Forms supports additional functionality through optional dependencies. You can install these dependencies individually or as extras.</p>"},{"location":"install/#messagepack-support","title":"MessagePack Support","text":"<p>To handle <code>application/x-msgpack</code> HTTP content type, you need to install the msgpack package:</p> <pre><code># Install with the msgpack extra\npip install django-api-forms[msgpack]\n\n# Or install msgpack separately\npip install msgpack\n</code></pre>"},{"location":"install/#file-and-image-fields","title":"File and Image Fields","text":"<p>The library provides <code>FileField</code> and <code>ImageField</code> which are similar to Django's native implementation. These fields require Pillow to be installed:</p> <pre><code># Install with the Pillow extra\npip install django-api-forms[Pillow]\n\n# Or install Pillow separately\npip install Pillow\n</code></pre>"},{"location":"install/#rrule-field","title":"RRule Field","text":"<p>To use the <code>RRuleField</code> for recurring date rules, you need to install python-dateutil:</p> <pre><code># Install with the rrule extra\npip install django-api-forms[rrule]\n\n# Or install python-dateutil separately\npip install python-dateutil\n</code></pre>"},{"location":"install/#geojson-field","title":"GeoJSON Field","text":"<p>To use the <code>GeoJSONField</code> for geographic data, you need to install GDAL:</p> <pre><code># Install with the gdal extra\npip install django-api-forms[gdal]\n\n# Or install GDAL separately\npip install gdal\n</code></pre>"},{"location":"install/#installing-multiple-extras","title":"Installing Multiple Extras","text":"<p>You can install multiple extras in a single command:</p> <pre><code># Install all extras\npip install django-api-forms[Pillow,msgpack,rrule,gdal]\n\n# Or just the ones you need\npip install django-api-forms[Pillow,msgpack]\n</code></pre>"},{"location":"install/#django-settings","title":"Django Settings","text":"<p>No specific Django settings are required to use Django API Forms, but you can customize its behavior by adding settings to your <code>settings.py</code> file. See the Example page for available settings.</p>"},{"location":"tutorial/","title":"Tutorial","text":"<p>This library helps you to handle basic RESTful API use-cases with Django Forms fashion. Library kinda replaces <code>django.forms.Form</code> with <code>django_api_forms.Form</code> and introduces few extra fields (boolean handling, BASE64 images/files, nesting).</p> <p><code>django_api_forms.Form</code> defines the format of the request and help you with:</p> <ul> <li>payload parsing (according to the <code>Content-Type</code> HTTP header)</li> <li>data validation and normalisation (using Django validators or custom <code>clean_</code> method)</li> <li>BASE64 file/image upload</li> <li>construction of the basic validation response</li> <li>filling objects attributes (if possible, see exceptions) using <code>setattr</code> function (super handy for Django database models)</li> </ul>"},{"location":"tutorial/#construction","title":"Construction","text":"<p>You can create form objects using class method <code>Form.create_from_request(request: Request) -&gt; Form</code> which creates form instance from Django requests using appropriate parser from Content-Type HTTP header. You can also pass any extra argument into <code>Form.create_from_request(request, param1=request.GET.get('param'), param2=param2) -&gt; Form</code></p> <pre><code>from tests.testapp.forms import AlbumForm\n\ndef my_view(request):\n    form = AlbumForm.create_from_request(request=request, param=request.GET.get('param'))\n</code></pre> <p>Library by default keeps configuration for handling:</p> <ul> <li>JSON (using <code>jsong.loads</code>),</li> <li>msgpack (requires msgpack package).</li> </ul> <p>You can extend or override that behavior by setting the <code>DJANGO_API_FORMS_PARSERS</code> variable in your <code>settings.py</code>. Default settings for such variables are listed in the Example documentation page.</p> <p>During construction <code>Form.dirty: List[str]</code> property is populated with property keys presented in the obtained payload (dirty sluts!!).</p>"},{"location":"tutorial/#mapping","title":"Mapping","text":"<p>You can use <code>Meta</code> class in specific <code>Form</code> class with optional dictionary type attribute <code>mapping = {}</code> which allows you to map JSON attributes to <code>Form</code> attributes:</p> <p>JSON example</p> <pre><code>{\n    \"_name\": \"Queen\",\n    \"formed\": \"1970\",\n    \"has_award\": true\n}\n</code></pre> <p>Python representation</p> <pre><code>from django.forms import fields\n\nfrom django_api_forms import BooleanField, Form\n\n\nclass BandForm(Form):\n    class Meta:\n        mapping = {\n            '_name': 'name'\n        }\n\n    name = fields.CharField(max_length=100)\n    formed = fields.IntegerField()\n    has_award = BooleanField()\n</code></pre>"},{"location":"tutorial/#validation-and-normalisation","title":"Validation and normalisation","text":"<p>This process is much more simple than in classic Django form. It consists of:</p> <ol> <li>Iterating over form attributes:</li> <li>calling <code>Field.clean(value)</code> method</li> <li>calling <code>Form.clean_&lt;field_name&gt;</code> method</li> <li>calling <code>Form.add_error((field_name, ), error)</code> in case of failures in clean methods</li> <li>if field is marked as dirty, normalized attribute is saved to <code>Form.clean_data</code> property</li> <li>Calling <code>Form.clean</code> method which returns final normalized values which will be presented in <code>Form.clean_data</code> (feel free to override it, by default does nothing, useful for conditional validation, you can still add errors using <code>Form.add_error()</code>). <code>Form.clean</code> is only called when there are no errors from previous section.</li> </ol> <p>Normalized data are available in <code>Form.clean_data</code> property (keys suppose to correspond with values from <code>Form.dirty</code>). Extra optional arguments are available in <code>Form.extras</code> property (keys suppose to correspond with values from <code>Form</code> initialization)</p> <p>Validation errors are presented for each field in <code>Form.errors: List[ValidationError]</code> property after <code>Form.is_valid()</code> method is called.</p> <p>As was mentioned above, you can extend property validation or normalisation by creating form method like <code>clean_&lt;property_name&gt;</code>. You can add additional ValidationError objects using <code>Form.add_error(field: Tuple, error: ValidationError)</code> method. Result is final normalised value of the attribute.</p> <pre><code>from django.forms import fields\nfrom django.core.exceptions import ValidationError\nfrom django_api_forms import Form\n\nclass BookForm(Form):\n    title = fields.CharField(max_length=100)\n    year = fields.IntegerField()\n\n    def clean_title(self):\n        if self.cleaned_data['title'] == \"The Hitchhiker's Guide to the Galaxy\":\n            self.add_error(('title', ), ValidationError(\"Too cool!\", code='too-cool'))\n\n        if 'param' not in self.extras:\n            raise ValidationError(\"You can use extra optional arguments in form validation!\")\n        return self.cleaned_data['title'].upper()\n\n    def clean(self):\n        if self.cleaned_data['title'] == \"The Hitchhiker's Guide to the Galaxy\" and self.cleaned_data['year'] &lt; 1979:\n            # Non field validation errors are present under key `$body` in Form.errors property\n            raise ValidationError(\"Is it you Doctor?\", code='time-travelling')\n\n        if 'param' not in self.extras:\n            self.add_error(\n                ('param', ),\n                ValidationError(\"You can use extra optional arguments in form validation!\", code='param-where')\n            )\n        # The last chance to do some touchy touchy with the self.clean_data\n\n        return self.cleaned_data\n</code></pre>"},{"location":"tutorial/#nesting","title":"Nesting","text":"<p>Django API Forms provides powerful support for nested data structures through specialized fields like <code>FormField</code> and <code>FormFieldList</code>. This allows you to validate complex JSON structures with nested objects and arrays.</p>"},{"location":"tutorial/#nested-objects-with-formfield","title":"Nested Objects with FormField","text":"<p>The <code>FormField</code> allows you to embed one form inside another, enabling validation of nested objects:</p> <pre><code>from django.forms import fields\nfrom django_api_forms import Form, FormField\n\n# Define a nested form\nclass AddressForm(Form):\n    street = fields.CharField(max_length=100)\n    city = fields.CharField(max_length=50)\n    postal_code = fields.CharField(max_length=10)\n    country = fields.CharField(max_length=50)\n\n# Use the nested form in a parent form\nclass UserForm(Form):\n    name = fields.CharField(max_length=100)\n    email = fields.EmailField()\n    address = FormField(form=AddressForm)  # Nested form\n</code></pre> <p>This setup can validate JSON like:</p> <pre><code>{\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"address\": {\n        \"street\": \"123 Main St\",\n        \"city\": \"New York\",\n        \"postal_code\": \"10001\",\n        \"country\": \"USA\"\n    }\n}\n</code></pre>"},{"location":"tutorial/#nested-arrays-with-formfieldlist","title":"Nested Arrays with FormFieldList","text":"<p>The <code>FormFieldList</code> field allows you to validate arrays of objects, where each object is validated against a specified form:</p> <pre><code>from django.forms import fields\nfrom django_api_forms import Form, FormFieldList\n\n# Define a form for each item in the list\nclass PhoneNumberForm(Form):\n    type = fields.CharField(max_length=20)\n    number = fields.CharField(max_length=20)\n\n# Use the form list in a parent form\nclass ContactForm(Form):\n    name = fields.CharField(max_length=100)\n    phone_numbers = FormFieldList(form=PhoneNumberForm)  # List of nested forms\n</code></pre> <p>This setup can validate JSON like:</p> <pre><code>{\n    \"name\": \"John Doe\",\n    \"phone_numbers\": [\n        {\n            \"type\": \"home\",\n            \"number\": \"555-1234\"\n        },\n        {\n            \"type\": \"work\",\n            \"number\": \"555-5678\"\n        }\n    ]\n}\n</code></pre>"},{"location":"tutorial/#validation-in-nested-forms","title":"Validation in Nested Forms","text":"<p>Each nested form performs its own validation. If a nested form fails validation, the errors are propagated to the parent form with the appropriate path:</p> <pre><code>class AddressForm(Form):\n    street = fields.CharField(max_length=100)\n\n    def clean_street(self):\n        if \"PO Box\" in self.cleaned_data['street']:\n            raise ValidationError(\"PO Boxes are not accepted\")\n        return self.cleaned_data['street']\n</code></pre> <p>If validation fails, the error will be available in the parent form's errors with the path to the nested field.</p>"},{"location":"tutorial/#database-relationships","title":"Database relationships","text":"<p>Django API Forms provides support for working with Django model relationships through Django's <code>ModelChoiceField</code> and <code>ModelMultipleChoiceField</code>.</p>"},{"location":"tutorial/#single-relationships-with-modelchoicefield","title":"Single Relationships with ModelChoiceField","text":"<p>You can use <code>ModelChoiceField</code> to handle foreign key relationships:</p> <pre><code>from django.forms import ModelChoiceField\nfrom django_api_forms import Form\nfrom myapp.models import Author\n\nclass BookForm(Form):\n    title = fields.CharField(max_length=100)\n    author = ModelChoiceField(queryset=Author.objects.all())\n</code></pre> <p>By default, this expects the primary key of the related object. You can customize this with the <code>to_field_name</code> parameter:</p> <pre><code>class BookForm(Form):\n    title = fields.CharField(max_length=100)\n    author_username = ModelChoiceField(\n        queryset=Author.objects.all(),\n        to_field_name='username'\n    )\n</code></pre>"},{"location":"tutorial/#many-to-many-relationships-with-modelmultiplechoicefield","title":"Many-to-Many Relationships with ModelMultipleChoiceField","text":"<p>For many-to-many relationships, you can use <code>ModelMultipleChoiceField</code>:</p> <pre><code>from django.forms import ModelMultipleChoiceField\nfrom django_api_forms import Form\nfrom myapp.models import Tag\n\nclass ArticleForm(Form):\n    title = fields.CharField(max_length=100)\n    tags = ModelMultipleChoiceField(queryset=Tag.objects.all())\n</code></pre> <p>This expects a list of primary keys for the related objects.</p>"},{"location":"tutorial/#populating-model-relationships","title":"Populating Model Relationships","text":"<p>When using <code>populate()</code> with model relationships, the appropriate population strategy is used based on the field type. For <code>ModelChoiceField</code>, the <code>ModelChoiceFieldStrategy</code> is used by default, which handles setting the relationship correctly.</p>"},{"location":"tutorial/#populate-objects","title":"Populate objects","text":"<p>Django API Forms provides a convenient way to populate objects (such as Django models) with validated form data using the <code>populate()</code> method.</p> <p>IMPORTANT: Form fields <code>FormField</code>, <code>FormFieldList</code>, <code>FileField</code> and <code>ImageField</code> don't support automatic population. You have to define a <code>populate_</code> method if you want these fields populated.</p> <p>The <code>MyForm.populate(obj: Any, exclude: List[str] = None)</code> method fills the input <code>obj</code> using <code>setattr</code> according to the form fields. Only data present in <code>cleaned_data</code> property (data from request) will be populated. You can use it like this:</p> <pre><code>from myapp.forms import AlbumForm\nfrom myapp.models import Album\n\ndef my_view(request):\n    form = AlbumForm.create_from_request(request)\n\n    if not form.is_valid():\n        # Handle validation error\n        return JsonResponse({\"errors\": form.errors}, status=400)\n\n    album = Album()\n    form.populate(album)\n    album.save()\n\n    return JsonResponse({\"id\": album.id})\n</code></pre>"},{"location":"tutorial/#population-strategies","title":"Population strategies","text":"<p>Library provides ability to change population strategy for each field using <code>DJANGO_API_FORMS_POPULATION_STRATEGIES</code> setting, or you can access settings directly <code>form.settings.POPULATION_STRATEGIES</code>. If there is no population strategy provided for field type, the <code>DJANGO_API_FORMS_DEFAULT_POPULATION_STRATEGY</code> is used. Default values are listed bellow:</p> <pre><code>DJANGO_API_FORMS_POPULATION_STRATEGIES = {\n    'django_api_forms.fields.FormFieldList': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.FileField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.ImageField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django_api_forms.fields.FormField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django.forms.models.ModelMultipleChoiceField': 'django_api_forms.population_strategies.IgnoreStrategy',\n    'django.forms.models.ModelChoiceField': 'django_api_forms.population_strategies.ModelChoiceFieldStrategy'\n}\n\nDJANGO_API_FORMS_DEFAULT_POPULATION_STRATEGY = 'django_api_forms.population_strategies.BaseStrategy'\n</code></pre>"},{"location":"tutorial/#basestrategy","title":"BaseStrategy","text":"<p>Object property is populated using <code>1:1</code> mapping and setattr function.</p>"},{"location":"tutorial/#ignorestrategy","title":"IgnoreStrategy","text":"<p>If this strategy is used, the target object is kept untouched.</p>"},{"location":"tutorial/#modelchoicefield","title":"ModelChoiceField","text":"<p>Field name is expected to have format like this: <code>{field_name}(_{to_field_name})?</code> so library is able to automatically resolve payload key postfix according to the <code>to_field_name</code> attribute. If there is no <code>to_field_name</code> provided, field name should be <code>{field_name}</code> or <code>{field_name}_id</code>. Normalised data are present in <code>clean_data</code> under key <code>{field_name}</code> (e.g. <code>clean_data['{field_name}']</code>).</p> <p>Few examples (normalized data are in <code>clean_data['artist']</code> in all use-cases):</p> <pre><code>from django.forms import ModelChoiceField\nfrom django_api_forms import Form\n\nfrom tests.testapp.models import Artist\n\nclass MyFormNoPostfix(Form):\n    artist = ModelChoiceField(queryset=Artist.objects.all())\n\nclass MyFormFieldName(Form):\n    artist_name = ModelChoiceField(\n        queryset=Artist.objects.all(), to_field_name='name'\n    )\n\nclass MyFormWithId(Form):\n    artist_id = ModelChoiceField(queryset=Artist.objects.all())\n</code></pre>"},{"location":"tutorial/#customization","title":"Customization","text":""},{"location":"tutorial/#creating-custom-strategy","title":"Creating custom strategy","text":"<p>You can create your own population strategy by inheriting <code>BaseStrategy</code> and overriding it's <code>__call__(self, field, obj, key: str, value)</code> method.</p> <pre><code>from django_api_forms.population_strategies import BaseStrategy\n\n\nclass ExampleStrategy(BaseStrategy):\n    def __call__(self, field, obj, key: str, value):\n        # Do your logic here\n        setattr(obj, key, value)\n</code></pre>"},{"location":"tutorial/#override-strategy","title":"Override strategy","text":"<p>You can override settings population strategies by creating your own population strategy in specific local <code>From</code> class using <code>Meta</code> class with optional attributes <code>field_type_strategy = {}</code> or <code>field_strategy = {}</code>: - <code>field_type_strategy</code>: Dictionary for overriding populate strategy on <code>Form</code> type attributes - <code>field_strategy</code>: Dictionary for overriding populate strategies on <code>Form</code> attributes</p> <pre><code>from django.forms import fields\n\nfrom django_api_forms import BooleanField, Form\nfrom django_api_forms.population_strategies import AliasStrategy\n\n\nclass BandForm(Form):\n    class Meta:\n        field_type_strategy = {\n            'django_api_forms.fields.BooleanField': 'app.population_strategies.ExampleStrategy1'\n        }\n\n        field_strategy = {\n            'formed': 'app.population_strategies.ExampleStrategy2',\n            'has_award': AliasStrategy(property_name='awarded')\n        }\n\n    name = fields.CharField(max_length=100)\n    formed = fields.IntegerField()\n    has_award = BooleanField()\n</code></pre>"},{"location":"tutorial/#using-populate_-method","title":"Using populate_ method","text":"<p>If you want to override population strategy for explicit field, you can define custom <code>populate_{field}</code> method inside your form class:</p> <pre><code>from django.forms import fields\n\nfrom django_api_forms import Form, FormField, EnumField, DictionaryField\nfrom tests.testapp.models import Album, Artist\nfrom tests.testapp.forms import ArtistForm\n\nclass AlbumForm(Form):\n    title = fields.CharField(max_length=100)\n    year = fields.IntegerField()\n    artist = FormField(form=ArtistForm)\n    type = EnumField(enum=Album.AlbumType, required=True)\n    metadata = DictionaryField(value_field=fields.DateTimeField())\n\n    def populate_year(self, obj, value: int) -&gt; int:\n        return 2020\n\n    def populate_artist(self, obj, value: dict) -&gt; Artist:\n        artist = Artist.objects.get_or_create(\n            name=value['name']\n        )\n        artist.genres = value['genres']\n        artist.members = value['members']\n        artist.save()\n        return artist\n</code></pre>"},{"location":"tutorial/#file-uploads","title":"File uploads","text":"<p>Django API Forms provides support for file uploads through BASE64-encoded data using the <code>FileField</code> and <code>ImageField</code> fields. This approach is particularly useful for RESTful APIs where traditional multipart form data might not be the preferred method.</p>"},{"location":"tutorial/#using-filefield","title":"Using FileField","text":"<p>The <code>FileField</code> allows you to handle BASE64-encoded files in your API requests:</p> <pre><code>from django.forms import fields\nfrom django_api_forms import Form, FileField\nfrom django.conf import settings\n\nclass DocumentForm(Form):\n    title = fields.CharField(max_length=100)\n    document = FileField(\n        max_length=settings.DATA_UPLOAD_MAX_MEMORY_SIZE,\n        mime=('application/pdf', 'application/msword')\n    )\n</code></pre> <p>The client would send a request with the file encoded as a Data URI:</p> <pre><code>{\n    \"title\": \"My Document\",\n    \"document\": \"data:application/pdf;base64,JVBERi0xLjQKJcOkw7zDtsOfCjIgMCBvYmoKPDwvTGVuZ3RoIDMgMCBSL0ZpbHRlci9GbGF0ZURlY29kZT4+CnN0cmVhbQp4nDPQM1Qo5ypUMFAw0DMwslAwtTTVMzIxV7AwMdSzMDNUKErlCtdSyOMyVADBonQuAJEWCTcKZW5kc3RyZWFtCmVuZG9iagoKMyAwIG9iago2OQplbmRvYmoKCjUgMCBvYmoKPDwKPj4KZW5kb2JqCgo2IDAgb2JqCjw8L0ZvbnQgNSAwIFIKL1Byb2NTZXRbL1BERi9UZXh0XQo+PgplbmRvYmoKCjEgMCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCA0IDAgUi9SZXNvdXJjZXMgNiAwIFIvTWVkaWFCb3hbMCAwIDU5NSA4NDJdL0dyb3VwPDwvUy9UcmFuc3BhcmVuY3kvQ1MvRGV2aWNlUkdCL0kgdHJ1ZT4+L0NvbnRlbnRzIDIgMCBSPj4KZW5kb2JqCgo0IDAgb2JqCjw8L1R5cGUvUGFnZXMKL1Jlc291cmNlcyA2IDAgUgovTWVkaWFCb3hbIDAgMCA1OTUgODQyIF0KL0tpZHNbIDEgMCBSIF0KL0NvdW50IDE+PgplbmRvYmoKCjcgMCBvYmoKPDwvVHlwZS9DYXRhbG9nL1BhZ2VzIDQgMCBSCi9PcGVuQWN0aW9uWzEgMCBSIC9YWVogbnVsbCBudWxsIDBdCi9MYW5nKGVuLVVTKQo+PgplbmRvYmoKCjggMCBvYmoKPDwvQ3JlYXRvcjxGRUZGMDA1NzAwNzIwMDY5MDA3NDAwNjUwMDcyPgovUHJvZHVjZXI8RkVGRjAwNEMwMDY5MDA2MjAwNzIwMDY1MDA0RjAwNjYwMDY2MDA2OTAwNjMwMDY1MDAyMDAwMzYwMDJFMDAzMT4KL0NyZWF0aW9uRGF0ZShEOjIwMjMwMzEwMTIzNDU2KzAxJzAwJyk+PgplbmRvYmoKCnhyZWYKMCA5CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDI1MyAwMDAwMCBuIAowMDAwMDAwMDE5IDAwMDAwIG4gCjAwMDAwMDAxNTkgMDAwMDAgbiAKMDAwMDAwMDM5MSAwMDAwMCBuIAowMDAwMDAwMTc4IDAwMDAwIG4gCjAwMDAwMDAxOTkgMDAwMDAgbiAKMDAwMDAwMDQ4OSAwMDAwMCBuIAowMDAwMDAwNTg1IDAwMDAwIG4gCnRyYWlsZXIKPDwvU2l6ZSA5L1Jvb3QgNyAwIFIKL0luZm8gOCAwIFIKL0lEIFsgPEY3RDc3QjNEMjJCOUY5MjgyOTQ2QTNCQTYxRDk3NjEzPgo8RjdENzdCM0QyMkI5RjkyODI5NDZBM0JBNjFEOTc2MTM+IF0KL0RvY0NoZWNrc3VtIC9BQjQwRDdGOUE3QkIwQkIwMTlDNEQ4NkJCNkFDQkM1Qgo+PgpzdGFydHhyZWYKNzU5CiUlRU9GCg==\"\n}\n</code></pre>"},{"location":"tutorial/#using-imagefield","title":"Using ImageField","text":"<p>The <code>ImageField</code> is similar to <code>FileField</code> but specifically for images. It performs additional validation to ensure the file is a valid image:</p> <pre><code>from django.forms import fields\nfrom django_api_forms import Form, ImageField\nfrom django.conf import settings\n\nclass ProfileForm(Form):\n    name = fields.CharField(max_length=100)\n    avatar = ImageField(\n        max_length=settings.DATA_UPLOAD_MAX_MEMORY_SIZE,\n        mime=('image/jpeg', 'image/png')\n    )\n</code></pre> <p>The client would send a request with the image encoded as a Data URI:</p> <pre><code>{\n    \"name\": \"John Doe\",\n    \"avatar\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+P+/HgAFdwI2Q4g02QAAAABJRU5ErkJggg==\"\n}\n</code></pre>"},{"location":"tutorial/#handling-uploaded-files","title":"Handling Uploaded Files","text":"<p>When a form with a <code>FileField</code> or <code>ImageField</code> is validated, the field's value in <code>cleaned_data</code> is a Django <code>File</code> object. For <code>ImageField</code>, there's also an <code>image</code> attribute containing a Pillow <code>Image</code> object:</p> <pre><code>def upload_profile(request):\n    form = ProfileForm.create_from_request(request)\n\n    if not form.is_valid():\n        return JsonResponse({\"errors\": form.errors}, status=400)\n\n    # Access the file\n    avatar_file = form.cleaned_data['avatar']\n\n    # For ImageField, you can access the Pillow Image object\n    image = avatar_file.image\n\n    # Get the content type\n    content_type = avatar_file.content_type  # e.g., 'image/png'\n\n    # Save the file to disk or cloud storage\n    with open(f\"media/avatars/{form.cleaned_data['name']}.png\", 'wb') as f:\n        f.write(avatar_file.read())\n\n    return JsonResponse({\"status\": \"success\"})\n</code></pre>"},{"location":"tutorial/#populating-models-with-file-fields","title":"Populating Models with File Fields","text":"<p>As mentioned in the \"Populate objects\" section, <code>FileField</code> and <code>ImageField</code> don't support automatic population. You need to define a custom <code>populate_</code> method:</p> <pre><code>from django.forms import fields\nfrom django_api_forms import Form, ImageField\nfrom myapp.models import Profile\n\nclass ProfileForm(Form):\n    name = fields.CharField(max_length=100)\n    avatar = ImageField(max_length=10485760, mime=('image/jpeg', 'image/png'))\n\n    def populate_avatar(self, obj, value):\n        # Save the file to the model's ImageField\n        filename = f\"{obj.id}_avatar.png\"\n        obj.avatar.save(filename, value, save=False)\n        return obj.avatar\n</code></pre> <p>This approach allows you to handle file uploads in a RESTful way without relying on multipart form data.</p>"}]}